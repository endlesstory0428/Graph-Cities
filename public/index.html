<!DOCTYPE html>
<html>
	<head>
		<title>Graph Strata</title>
		
		<link rel="stylesheet" type="text/css" href="lib/dat.gui.css" />
		
		<link id="style-main" rel="stylesheet" type="text/css" href="css/main.css" />
		<link id="style-light" rel="stylesheet" type="text/css" href="lib/light.css"  />
		<link id="style-dark" rel="stylesheet" type="text/css" href="lib/dark.css" disabled="true"/>
		
		<script type="text/javascript" src="lib/socket.io.js"></script>
		<script type="text/javascript" src="lib/stats.js"></script>
		<script type="text/javascript" src="lib/dat.gui.js"></script>
		<script type="text/javascript" src="lib/d3-v5.js"></script>
		<script type="text/javascript" src="lib/d3-tip.js"></script>
		<script type="text/javascript" src="lib/d3-scale-chromatic.js"></script>
		<script type="text/javascript" src="lib/union-find.js"></script>
		
		<script type="text/javascript" src="lib/three.js"></script>
		
		<script type="text/javascript" src="lib/util.js"></script>
		<script type="text/javascript" src="lib/controls.js"></script>

		<script type="text/javascript" src="js/simulation.js"></script>
		
		<script type="text/javascript" src="lib/graph.js"></script>
		<script type="text/javascript" src="lib/graph-algorithms.js"></script>
		<script type="text/javascript" src="js/G.js"></script>
		<script type="text/javascript" src="js/G-controls.js"></script>
		<script type="text/javascript" src="js/G-algorithms.js"></script>
		<script type="text/javascript" src="js/G-loading.js"></script>
		<script type="text/javascript" src="js/G-preprocessing.js"></script>
		<script type="text/javascript" src="js/G-analytics.js"></script>
		<script type="text/javascript" src="js/G-view.js"></script>
		<script type="text/javascript" src="js/G-ui.js"></script>
		<script type="text/javascript" src="js/G-subview.js"></script>
		<script type="text/javascript" src="js/G-scene.js"></script>
		<script type="text/javascript" src="js/G-messaging.js"></script>
		<script type="text/javascript" src="js/G-animation.js"></script>
		
		
		

	</head>

	<body>
		<div id="canvas" width="100%" height="100%"></div>
		<div id="label-container" class="simple fixed" style="background:transparent;width:100%;height:100%;pointer-events:none;"></div>

		<!-- grid-like controls -->
		<div class="simple fixed" style="top:0;height: 10%;margin:10px;left:10%;right:10%;color:dark-grey;font-size:smaller;text-align:center;">
			<p id="minimal-graph-title"  class="simple" style="width:100%;text-transform: uppercase;text-align:center;"></p>
			<p id="minimal-graph-desc" class="simple" style="font-size:x-small;width:100%;text-align:center;"></p>
		</div>
		
		
		<div id="top-bar" class="simple fixed" style="position:absolute;top:0;height:10%;width:100%;box-sizing: border-box;">
			
			<div id="top-left-corner" class="simple centering" style="width:10%;height:100%;background:#37474F;color:white;" >
			<!-- #122933; -->
				<!--div id="graph-buttons-area"></div-->
				<img id="overview-image" class="simple" style="border:1px solid #37474F;width:100%;height:100%;" src="images/blank.png"></img>
				
			</div>
			
			<div id="top-middle-area" class="simple fixed" style="display: flex;flex-flow: column;top:0;height: 100%;left:10%;right:10%;background: #37474F;color:white;font-size:larger;">
				<div id="top-level-summary-area" class="simple" style="display:flex;flex-flow:column;text-align:center;height:62%;">
					<div  style=""class="simple">
						<span id="top-level-graph-name" class="simple" style="font-size:smaller;font-weight: bold;"> </span>
						<span id="top-level-summary" class="simple" style="font-size:x-small"> </span>
					</div>
					
					<div id="top-level-plots-area" class="simple" style="display:none;flex-flow:row;">
						<svg id="top-level-cc-plot" width="180" height="50" style="background-color:transparent;width:170px;height:50px;"></svg>
						<svg id="top-level-cc-plot2" width="180" height="50" style="background-color:transparent;width:170px;height:50px;"></svg>
						<!--svg id="top-level-peel-value-plot" width="180" height="100" style="background-color:grey;width:180px;height:70px;"></svg-->
					</div>
					

				</div>
				<div id="top-level-cc-buckets-area" class="simple flex row" style="height:5px;width:100%;display: flex;font-size:x-small"></div>
				<div id="current-graph-summary-area" class="simple flex row centering" style="width: 75%;z-index: 2;background: linear-gradient(rgba(0, 62, 62, 0.1),transparent);position: absolute;top: 88%;color: black;flex-flow: column;flex: 1 0 auto; margin-left: 15%;margin-right: 15%;">
					<p id="graph-name" class="simple" style="display:none;width:100%;text-align: center;"></p>
					<div id="hierarchy-path" class="simple" style="display: inline;margin-top: 10px;text-align: center;font-size:smaller"></div>
					
					<p id="graph-desc" class="simple" style="font-size:x-small;text-align: center;"> </p>
					<p id="graph-info" class="simple" style="display:none;font-size:x-small;text-align: center;"> </p>
					<p id="graph-metagraph-list" class="simple" style="font-size:x-small;text-align: center;"> </p>
				</div>
				
			</div>
			<div id="top-right-corner" class="simple flex fixed column centering"  style="text-transform:uppercase;font-size: xx-small;width:10%;top:0;height:100%;left:90%;background: #37474F;color:white;" ><!-- background:#385a6b;-->
				<!--div id="graph-strata-buttons-area"></div-->
				<p>Graph Strata</p>
				<p>Version 1 </br>3/27/2019</p>
			</div>
		
		</div>
		
		<div id="left-panel" class="simple fixed" style="overflow-x:visible;position:absolute;top:10%;height:80%;width:10%;min-width:170px;box-sizing: border-box;">
			<div id="ribbon-menu" class="simple column" style="overflow-x:visible;overflow-y:auto;border:none;width:100%;height: 100%;">
				<div style="width:100%;">
					<p style="float:left;font-size:x-small;">Layer</p>
					<p style="transform: translateX(45%);font-size:x-small;"># CCs</p>
				</div>
				<svg id="ribbon-scale" width="100" height="30" style="width:100%;height:30px;"/>
				<div id="ribbon-menu-contents" class="menu-content" style="overflow-x:visible;overflow-y:auto;padding-bottom: 55px;">
				</div>
				<div id="top-level-cc-ribbon-area" class="simple" style="display:flex;flex-flow:column;align-items:flex-start;justify-content: space-between;">
				</div>
			</div>
		</div>
		
		
		<div id="right-panel" class="simple column fixed" style="position:absolute;top:10%;height:80%;right:0;width:10%;min-width:170px;box-sizing: border-box;margin-right:1px;">
			<div id="controls-menu" class="simple column scrolling-y" style="width:100%;font-family: monospace;">
				
			</div>
			
		</div>
		
		<div id="bottom-bar" class="simple fixed" style="position:absolute;bottom:0;height:10%;width:100%;box-sizing: border-box;background-color:rgba(0,0,0,0.05)">
			
			<div id="bottom-left-corner" class="simple centering wrap" style="width:10%;height:100%;background-color:transparent;" >
				<div id="view-buttons-area" class="simple column" ></div>
			</div>
			<div id="bottom-middle-area" class="simple fixed" style="display: flex;flex-flow: column;bottom:0;height: 100%;left:10%;right:10%;">
				<div id="style-controls-area">
				</div>
				<p class="simple" style="width:100%;font-size:small;text-align:center;">DESIGN: James Abello, NSF Project</p>
			</div>
			<div id="bottom-right-corner" class="simple fixed centering"  style="width:10%;bottom:0;height:100%;left:90%;background-color:transparent;" >
				<div id="graph-semantics-buttons-area" class="simple column"></div>
			</div>
		
		</div>
		
		
		<div id="minimal-bar" class="simple fixed" style="display:none;position:absolute;bottom:0;height:8%;min-height:55px;width:100%;box-sizing: border-box;background-color:rgba(0,0,0,0.05);font-family: monospace;"> <!-- alternative minimal UI -->
			
			<div id="minimal-style-controls-area" class="simple fixed minimal" style="display: flex;flex-flow: column wrap;
		justify-self: center;
		align-self: flex-end;
    bottom: 0;
    height: 100%;
    left: 10%;
    right: 10%;">
			
			
			</div>
			
		</div>
		
		
		<!-- other stuff -->
		<img id="minimap" class="simple fixed" style="display:none;top:15%;left:15%;width:15%;"src="images/blank.png"></img>
		<div id="exploration-area" class="simple column fixed" style="top:10%;right:10%;width:10%;" ></div>
		

		<div id="new-graph-menu" class="panel" style="display:none;">
			
			
			<div id="graph-tools-area" style="display:none;">
				
			
			</div>
			
			
		</div>
		
		
		<div id="graph-menu" class="panel" style="min-width:300px;">
			
			<table id="graph-layers" style="display:none;" >
				<thead>
					<tr id="title"></tr>
					<tr id="columns"></tr>
				</thead>
				<tbody></tbody>
			</table>
			<div>
				<p id="selected-vertices">selected vertices</p>
				<input type="text" id="select-vertex-input" value=""></input>
				<div id="selection-buttons-area"></div>
			</div>
			<div id="subgraph-filtering-area">
				
				
			</div>
			<div id="item-bar-container" >
				<div id= "item-bar-title"><p> Saved graphs </p></div>
				<div id="item-bar" >
				</div>
			</div>
			
			
			
			
		</div>
		
		
		
		<div id="style-menu" class="panel" style="min-width:300px;overflow-y: scroll;font-size: x-small;">
		
		</div>
		
		
		<div id="ribbon-tooltip" class="tooltip">
			<p id="ribbon-description"></p>
			<div id="ribbon-histogram"></div>
			<svg id="ribbon-vertex-dist" width="180" height="90"style="background-color:grey;width:180px;height:90px;"></svg>
			<svg id="ribbon-edge-dist" width="180" height="90" style="background-color:grey;width:180px;height:90px;"></svg>
			
		</div>
		
		<div id="selecting-region" style="display:none"></div>
		
		<!--  dialogs  -->
		<div id="dataset-menu" class="panel menu" >
			<p style="font-size: 24px;padding:10px;">Datasets</span>
			<button class="close-button material" onclick="selectE('dataset-menu').style('display','none');">×</button>
			<div id="dataset-menu-content" class="dialog-content"></div>
		</div>
		<div id="layer-menu" class="panel menu" >
			<p style="font-size: 24px;padding:10px;">Choose Layer</span>
			<button class="close-button material small" onclick="selectE('layer-menu').style('display','none');">×</button>
			<div id="layer-menu-content" class="dialog-content">
			
				<table id="menu-layers">
					<thead>
						<tr id="title"></tr>
						<tr id="columns"></tr>
					</thead>
					<tbody></tbody>
				</table>
			</div>
			
		</div>
		
		<div id="X-ray-menu" class="panel menu fixed" style="top:10%;left:0;height:80%;width:10%;z-index:5;background-color:white;">
			<button class="close-button material small" onclick="getE('X-ray-menu').style.display='none';">×</button>
			<p style="">Wave levels</p>
			<div id="X-ray-menu-content" class="dialog-content" style="text-align:center;overflow-x:hidden;font-size:x-small;">
			
			</div>
		</div>
		
		<div id="trapezoid-menu" class="panel menu" style="overflow: visible;">
			<button class="close-button material small" onclick="getE('trapezoid-menu').style.display='none';">×</button>
			<p style="">trapezoids</p>
			<div id="trapezoid-menu-content" class="dialog-content" style="overflow: visible;text-align:center;font-size:x-small;">
			
			</div>
		</div>
		<div id="trapezoid-input-menu" class="panel menu" >
			<button class="close-button material small" onclick="getE('trapezoid-input-menu').style.display='none';">×</button>
			<p style="">Input trapezoids data</p>
			<textarea id="trapezoid-input-menu-content" class="dialog-content" style="height:80%;width:90%;font-size:x-small;">{"sets": {"0": [98397538], "1": [25022977, 16198754, 58507971, 91606375, 15258316, 67065236, 10092057, 80606654, 19774751]}, "adj": {"0": {"1": 9}, "1": {"0": 9}}}</textarea>

			<button style="" onclick="let data=JSON.parse(getE('trapezoid-input-menu-content').value.trim());G.ui.showTrapezoids(data);">Go</button>
			<input type="file" id="wave-metadata-file">upload file</>
			<button style="" onclick="let fr = new FileReader();fr.onload = function(){let data=JSON.parse(fr.result);G.ui.showTrapezoids(data);};fr.readAsText(document.getElementById('wave-metadata-file').files[0]);">Use file</button>
		</div>
		
		
		<div id="edge-list-menu" class="panel menu">
			<button class="close-button material small" onclick="getE('edge-list-menu').style.display='none';">×</button>
			<p style="">Edgelist</p>
			<textarea id="edge-list-menu-content" class="dialog-content" style="height:70%;width:90%;"></textarea>
			<button style="" onclick="getE('edge-list-menu').style.display='none';let g=buildGraphFromText(null,getE('edge-list-menu-content').value.trim());g.name='Custom graph';G.display(g);">Go!</button>
			<input type="file" id="edge-list-file">upload file</>
			<button style="" onclick="let fr = new FileReader();fr.onload = function(){getE('edge-list-menu').style.display='none';let g=buildGraphFromText(null,fr.result);g.name='Custom graph';G.display(g);};fr.readAsText(document.getElementById('edge-list-file').files[0]);">Use file</button>
			
			<button style="" onclick="let fr = new FileReader();fr.onload = function(){
			getE('edge-list-menu').style.display='none';let obj;
			let result=buildSubgraphsFromText(fr.result);
			if(result.subgraphs.length>0){
				let first=result.subgraphs[0];
				first.heightProperty=null;first.nodeColorProperty='subgraph';
				first.modifiers={subgraphRange:{min:first.subgraphID,max:first.subgraphID,IP:32768}};
				G.display(result.subgraphs[0]);
				let totalSize=arraySum(result.subgraphs.map(x=>x.edges.length));

			}
			else{G.addLog('no subgraphs found');}
			};fr.readAsText(document.getElementById('edge-list-file').files[0]);">Use file with multiple graphs</button>
			
			<button style="" onclick="let fr = new FileReader();fr.onload = function(){
			getE('edge-list-menu').style.display='none';let obj;
			let result=buildSubgraphsFromText(fr.result);
			if(result.subgraphs.length>0){
				let first=result.subgraphs[0];
				let last=result.subgraphs[result.subgraphs.length-1];
				first.heightProperty=null;first.nodeColorProperty='subgraph';
				first.modifiers={subgraphRange:{min:first.subgraphID,max:first.subgraphID,IP:32768}};
				G.display(result.subgraphs[0]);
				let totalSize=arraySum(result.subgraphs.map(x=>x.edges.length));
				if(totalSize<32768){setTimeout(()=>{
					first.modifiers.subgraphRange.min=first.subgraphID;
					console.log(first.subgraphID,last.subgraphID);
					first.modifiers.subgraphRange.max=last.subgraphID;
					G.subview.onModifiersChanged('subgraphRange');},0)}
			}
			else{G.addLog('no subgraphs found');}
			};fr.readAsText(document.getElementById('edge-list-file').files[0]);">Draw DAG Cover</button>
			
			<button style="" onclick="let fr = new FileReader();fr.onload = function(){
				getE('edge-list-menu').style.display='none';
				let g=G.graph;if(!g.vertices.isNew)g.vertices.addProperty('isNew','int');
				if(!g.edges.isNew)g.edges.addProperty('isNew','int');
				g.loadEdges(fr.result,{vertices:(vID,graph)=>{graph.vertices.isNew[vID]=1;},edges:(eID,graph)=>{graph.edges.isNew[eID]=1;}});
				if(!g.modifiers)g.modifiers={};g.modifiers.highlight={property:'isNew',operator:'==',propertyValue:1,thicknessFactor:0.5};
				G.display(g);
			};fr.readAsText(document.getElementById('edge-list-file').files[0]);">Add edgelist to current graph</button>
		</div>
		
		
		<div id="selected-vertices-ids" class="panel menu" style="display:none">
			<p style="font-size: 24px;padding:10px;">Chosen Vertices Info</p>
			<button style="float:right" onclick="G.downloadVertexIDs()">Download</button>
			<button style="float:right" onclick="G.downloadImage()">Download Image</button>
			<a style="float:right" rel="noreferrer" target="_blank" id="selected-vertices-details-link" href="./">open details</a>
			<textarea id="selected-vertices-ids-content" style="font-size: larger;width:90%;height:90%;background-color:rgba(255,255,255,0.6);" class="dialog-content"></textarea>
		</div>

		<div id="wavemap-menu" class="panel menu opaque" style="z-index: 4;" >
			<p style="font-size: 24px;padding:10px;">Wave Map</span>
			<button class="close-button material small" onclick="selectE('wavemap-menu').style('display','none');">×</button>
			<div id="wavemap-menu-content" class="dialog-content">
			<svg id="wavemap" width="300" height="300"></svg>
			</div>
		</div>
		
	</body>
</html>